clouds:
    - aws
description: |
    Deploys Karpenter autoscaler for EKS clusters with automatic node provisioning and cost optimization.
    Karpenter directly provisions EC2 instances based on pod requirements, providing faster scaling and better cost efficiency than traditional Cluster Autoscaler.
flavor: karpenter
inputs:
    cloud_account:
        description: The AWS Cloud Account for EC2 instance provisioning
        displayName: Cloud Account
        optional: false
        providers:
            - aws
        type: '@facets/aws_cloud_account'
    kubernetes_details:
        description: The EKS cluster where Karpenter will be deployed
        displayName: Kubernetes Cluster
        optional: false
        providers:
            - kubernetes
            - helm
        type: '@facets/kubernetes-details'
    network_details:
        default:
            resource_name: default
            resource_type: network
        displayName: Network
        type: '@facets/aws-vpc-details'
intent: autoscaler
outputs:
    default:
        mock:
            attributes:
                controller_role_arn: mock-string-value
                interruption_queue_name: mock-string-value
                karpenter_namespace: mock-string-value
                karpenter_service_account: mock-string-value
                karpenter_version: mock-string-value
                node_instance_profile_name: mock-string-value
                node_role_arn: mock-string-value
                secrets: []
            interfaces: {}
        type: '@facets/karpenter-details'
sample:
    disabled: false
    flavor: karpenter
    kind: autoscaler
    spec:
        enable_consolidation: true
        enable_spot_instances: true
        karpenter_replicas: 2
        karpenter_version: 1.0.1
        node_pools:
            default:
                capacity_types:
                    - on-demand
                    - spot
                cpu_limits: "1000"
                instance_families:
                    - t3
                    - t3a
                instance_sizes:
                    - medium
                    - large
                    - xlarge
                memory_limits: 1000Gi
    version: "1.0"
spec:
    description: Configure Karpenter autoscaler for your EKS cluster
    properties:
        enable_consolidation:
            default: true
            description: Enable automatic node consolidation to optimize costs
            title: Enable Consolidation
            type: boolean
        enable_spot_instances:
            default: true
            description: Allow Karpenter to provision Spot instances for cost savings
            title: Enable Spot Instances
            type: boolean
        interruption_handling:
            default: true
            description: Enable interruption handling for Spot instances
            title: Enable Interruption Handling
            type: boolean
        karpenter_replicas:
            default: 2
            description: Number of Karpenter controller replicas for high availability
            maximum: 5
            minimum: 1
            title: Controller Replicas
            type: integer
        karpenter_version:
            default: 1.0.1
            description: Version of Karpenter to deploy (should match your Kubernetes version)
            title: Karpenter Version
            type: string
            x-ui-overrides-only: true
        node_pools:
            description: Configure node pools (provisioners) for different workload types
            patternProperties:
                ^[a-zA-Z0-9_-]+$:
                    properties:
                        architecture:
                            default:
                                - amd64
                            description: CPU architecture (amd64, arm64, or both)
                            items:
                                enum:
                                    - amd64
                                    - arm64
                                type: string
                            title: Architecture
                            type: array
                        capacity_types:
                            default:
                                - on-demand
                                - spot
                            description: Capacity types (on-demand, spot, or both)
                            items:
                                enum:
                                    - on-demand
                                    - spot
                                type: string
                            title: Capacity Types
                            type: array
                        cpu_limits:
                            default: "1000"
                            description: Maximum CPU cores across all nodes in this pool
                            title: CPU Limits
                            type: string
                            x-ui-placeholder: "1000"
                        instance_families:
                            default:
                                - t3
                                - t3a
                            description: EC2 instance families to use (e.g., t3, c5, r5, m5)
                            items:
                                type: string
                            title: Instance Families
                            type: array
                            x-ui-placeholder: t3, c5, m5
                        instance_sizes:
                            default:
                                - medium
                                - large
                                - xlarge
                            description: Instance sizes to allow (e.g., medium, large, xlarge)
                            items:
                                type: string
                            title: Instance Sizes
                            type: array
                            x-ui-placeholder: medium, large
                        labels:
                            description: Kubernetes labels to apply to provisioned nodes
                            title: Node Labels
                            type: object
                            x-ui-yaml-editor: true
                        memory_limits:
                            default: 1000Gi
                            description: Maximum memory across all nodes in this pool
                            title: Memory Limits
                            type: string
                            x-ui-placeholder: 1000Gi
                        taints:
                            description: Kubernetes taints to apply to provisioned nodes
                            title: Node Taints
                            type: object
                            x-ui-yaml-editor: true
                    type: object
            title: Node Pools
            type: object
        tags:
            description: Additional AWS tags to apply to provisioned instances
            title: Instance Tags
            type: object
            x-ui-yaml-editor: true
    required:
        - karpenter_version
    title: Karpenter Configuration
    type: object
    x-ui-order:
        - karpenter_version
        - karpenter_replicas
        - enable_spot_instances
        - enable_consolidation
        - interruption_handling
        - node_pools
        - tags
version: "1.0"
