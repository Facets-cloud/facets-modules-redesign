# Grafana Dashboard Module

This module creates a Kubernetes ConfigMap containing Grafana dashboard JSON configuration that can be automatically discovered and imported by Grafana Operator.

## Overview

The module deploys a Kubernetes ConfigMap with a special label (`grafana_dashboard: "1"`) that the Grafana Operator uses to discover and automatically import dashboard configurations. The dashboard configuration is provided as a JSON object in the module specification.

## Features

- Automatic dashboard discovery by Grafana Operator via ConfigMap labels
- Configurable dashboard UID (can be preserved or auto-generated)
- Support for custom labels and annotations
- Namespace configuration support
- Lowercase naming for Kubernetes resources

## How It Works

1. The module creates a Kubernetes ConfigMap with the label `grafana_dashboard: "1"`
2. The Grafana Operator watches for ConfigMaps with this label
3. When found, the operator automatically imports the dashboard JSON into Grafana
4. The dashboard JSON is stored with the key format: `grafana-dashboard-{instance_name}.json`

## Inputs

### Required

- `dashboard`: The Grafana dashboard configuration as a JSON object

### Optional

- `preserve_uid`: If `false` (default), a random 16-character UID is generated and overrides the dashboard UID. If `true`, the UID from the dashboard JSON is preserved.
- `metadata.namespace`: Custom namespace for the ConfigMap (defaults to environment namespace)
- `metadata.labels`: Additional labels to apply to the ConfigMap
- `metadata.annotations`: Additional annotations to apply to the ConfigMap

## Outputs

- `uid`: The generated or preserved dashboard UID
- `attributes`: Object containing:
  - `uid`: The dashboard UID
  - `configmap_name`: Name of the created ConfigMap
  - `namespace`: Namespace where the ConfigMap is deployed

## Usage Example

```yaml
kind: grafana_dashboard
flavor: k8s_standard
version: '1.0'
metadata:
  labels:
    team: platform
    environment: production
spec:
  dashboard:
    annotations:
      list: []
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 1
    panels:
      - title: CPU Usage
        type: graph
        datasource: Prometheus
        # ... panel configuration
    refresh: 30s
    schemaVersion: 37
    tags:
      - kubernetes
      - monitoring
    templating:
      list: []
    time:
      from: now-6h
      to: now
    timezone: utc
    title: Kubernetes Cluster Monitoring
    version: 1
  preserve_uid: false
```

## Advanced Configuration

You can also set `preserve_uid` via the advanced configuration block:

```yaml
advanced:
  default:
    preserve_uid: true
spec:
  dashboard:
    # ... dashboard JSON
```

## Requirements

- Kubernetes cluster with Grafana Operator installed
- The Grafana Operator must be configured to watch for ConfigMaps with the `grafana_dashboard: "1"` label

## Notes

- Dashboard names and ConfigMap names are automatically converted to lowercase
- A random 16-character UID is generated by default to avoid conflicts when importing dashboards
- The ConfigMap is created in the same namespace as specified in the environment or metadata configuration
