intent: network
flavor: gcp-vpc
version: '1.0'
description: Creates a GKE-optimized GCP VPC with auto-calculated subnets. Fixed allocation
  - Private (8K IPs), Public (256 IPs), Database (256 IPs), plus GKE secondary ranges
clouds:
- gcp
spec:
  type: object
  properties:
    vpc_cidr:
      type: string
      title: VPC CIDR Block
      description: CIDR block for the VPC (must be /16 for optimal GKE workloads)
      pattern: ^([0-9]{1,3}\.){3}[0-9]{1,3}/16$
      x-ui-overrides-only: true
      x-ui-error-message: VPC CIDR must be a /16 block (e.g., 10.0.0.0/16)
      x-ui-placeholder: 10.0.0.0/16
      default: 10.0.0.0/16
    auto_create_subnetworks:
      type: boolean
      title: Auto Create Subnetworks
      description: Auto-create subnets in all regions (not recommended for production)
      default: false
      x-ui-hidden: true
    enable_gke_setup:
      type: boolean
      title: Enable GKE Setup
      description: Create GKE-specific resources (secondary ranges, internal LB subnet)
      default: true
    nat_gateway:
      type: object
      title: Cloud NAT Configuration
      properties:
        strategy:
          type: string
          title: Cloud NAT Strategy
          description: Cloud NAT is always regional in GCP (single strategy only)
          enum:
          - single
          default: single
      required:
      - strategy
    firewall_rules:
      type: object
      title: Firewall Rules Configuration
      description: Configure VPC firewall rules for traffic control
      x-ui-toggle: true
      properties:
        allow_internal:
          type: boolean
          title: Allow Internal Traffic
          description: Allow all traffic between subnets within the VPC
          default: true
        allow_ssh:
          type: boolean
          title: Allow SSH Access
          description: Allow SSH access from the internet to instances with network
            tag 'ssh-access'
          default: true
        allow_http:
          type: boolean
          title: Allow HTTP Access
          description: Allow HTTP access from the internet to instances with network
            tag 'http-server'
          default: false
        allow_https:
          type: boolean
          title: Allow HTTPS Access
          description: Allow HTTPS access from the internet to instances with network
            tag 'https-server'
          default: true
        allow_icmp:
          type: boolean
          title: Allow ICMP
          description: Allow ICMP (ping) traffic within the VPC
          default: true
    enable_flow_logs:
      type: boolean
      title: Enable VPC Flow Logs
      description: Enable flow logs for network monitoring and security analysis
      default: false
    labels:
      type: object
      title: Additional Labels
      description: Optional additional labels to apply to all VPC resources. These
        will be merged with the standard environment labels.
      x-ui-yaml-editor: true
  required:
  - vpc_cidr
  - nat_gateway
inputs:
  cloud_account:
    type: '@facets/gcp_cloud_account'
    displayName: GCP Cloud Account
    description: The GCP Cloud Account where the VPC will be created (with region
      support)
    optional: false
    providers:
    - google
outputs:
  default:
    type: '@facets/gcp-network-details'
sample:
  kind: network
  flavor: gcp-vpc
  version: '1.0'
  spec:
    vpc_cidr: 10.0.0.0/16
    enable_gke_setup: true
    nat_gateway:
      strategy: single
    firewall_rules:
      allow_internal: true
      allow_ssh: true
      allow_http: false
      allow_https: true
      allow_icmp: true
    enable_flow_logs: false
iac:
  validated_files:
  - main.tf
  - variables.tf
