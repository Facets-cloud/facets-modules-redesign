intent: network
flavor: gcp-vpc
version: '1.0'
description: Creates a GCP VPC with configurable public subnets, private subnets,
  and database subnets across multiple zones
clouds:
- gcp
spec:
  type: object
  properties:
    vpc_cidr:
      type: string
      title: VPC CIDR Block
      description: CIDR block for the VPC (e.g., 10.0.0.0/16)
      pattern: ^([0-9]{1,3}\.){3}[0-9]{1,3}/[0-9]{1,2}$
      x-ui-overrides-only: true
      x-ui-error-message: CIDR must be a valid IP block (e.g., 10.0.0.0/16)
      x-ui-placeholder: 10.0.0.0/16
    region:
      type: string
      title: GCP Region
      description: GCP region where the VPC will be created
      default: us-central1
      x-ui-overrides-only: true
    auto_select_zones:
      type: boolean
      title: Auto Select Zones
      description: Automatically select any 3 zones from the region
      default: false
    zones:
      type: array
      title: GCP Zones
      description: List of GCP zones to use for subnets (space separated). Only used
        when auto_select_zones is false
      x-ui-overrides-only: true
      x-ui-visible-if:
        field: spec.auto_select_zones
        values:
        - false
    public_subnets:
      type: object
      title: Public Subnets Configuration
      properties:
        count_per_zone:
          type: number
          title: Public Subnets per Zone
          description: Number of public subnets to create in each zone
          minimum: 0
          maximum: 3
          default: 1
        subnet_size:
          type: string
          title: Public Subnet Size
          description: Number of IP addresses in each public subnet
          enum:
          - '256'
          - '512'
          - '1024'
          - '2048'
          - '4096'
          - '8192'
          default: '256'
      required:
      - count_per_zone
      - subnet_size
    private_subnets:
      type: object
      title: Private Subnets Configuration
      properties:
        count_per_zone:
          type: number
          title: Private Subnets per Zone
          description: Number of private subnets to create in each zone
          minimum: 0
          maximum: 3
          default: 1
        subnet_size:
          type: string
          title: Private Subnet Size
          description: Number of IP addresses in each private subnet
          enum:
          - '256'
          - '512'
          - '1024'
          - '2048'
          - '4096'
          - '8192'
          default: '1024'
      required:
      - count_per_zone
      - subnet_size
    database_subnets:
      type: object
      title: Database Subnets Configuration
      description: Configure dedicated subnets for database resources
      properties:
        count_per_zone:
          type: number
          title: Database Subnets per Zone
          description: Number of database subnets to create in each zone
          minimum: 0
          maximum: 3
          default: 1
        subnet_size:
          type: string
          title: Database Subnet Size
          description: Number of IP addresses in each database subnet
          enum:
          - '256'
          - '512'
          - '1024'
          - '2048'
          - '4096'
          - '8192'
          default: '256'
      required:
      - count_per_zone
      - subnet_size
    nat_gateway:
      type: object
      title: Cloud NAT Configuration
      properties:
        strategy:
          type: string
          title: Cloud NAT Strategy
          description: Choose whether to create one Cloud NAT or one per zone
          enum:
          - single
          - per_zone
          default: single
      required:
      - strategy
    firewall_rules:
      type: object
      title: Firewall Rules Configuration
      description: Configure VPC firewall rules for traffic control
      x-ui-toggle: true
      properties:
        allow_internal:
          type: boolean
          title: Allow Internal Traffic
          description: Allow all traffic between subnets within the VPC
          default: true
        allow_ssh:
          type: boolean
          title: Allow SSH Access
          description: Allow SSH access from the internet to instances with network
            tag 'ssh-access'
          default: true
        allow_http:
          type: boolean
          title: Allow HTTP Access
          description: Allow HTTP access from the internet to instances with network
            tag 'http-server'
          default: true
        allow_https:
          type: boolean
          title: Allow HTTPS Access
          description: Allow HTTPS access from the internet to instances with network
            tag 'https-server'
          default: true
        allow_icmp:
          type: boolean
          title: Allow ICMP
          description: Allow ICMP (ping) traffic within the VPC
          default: true
    private_google_access:
      type: object
      title: Private Google Access Configuration
      description: Configure private access to Google APIs and services
      x-ui-toggle: true
      properties:
        enable_private_subnets:
          type: boolean
          title: Enable for Private Subnets
          description: Enable Private Google Access for private subnets
          default: true
        enable_database_subnets:
          type: boolean
          title: Enable for Database Subnets
          description: Enable Private Google Access for database subnets
          default: true
    tags:
      type: object
      title: Additional Labels
      description: Optional additional labels to apply to all VPC resources. These
        will be merged with the standard environment labels.
      x-ui-yaml-editor: true
  required:
  - vpc_cidr
  - public_subnets
  - private_subnets
  - database_subnets
  - nat_gateway
inputs:
  cloud_account:
    type: '@facets/gcp_cloud_account'
    displayName: GCP Cloud Account
    description: The GCP Cloud Account where the VPC will be created (with region
      support)
    optional: false
    providers:
    - google
outputs:
  default:
    type: '@facets/gcp-network-details'
sample:
  kind: network
  flavor: gcp-vpc
  version: '1.0'
  spec:
    vpc_cidr: 10.0.0.0/16
    region: us-central1
    auto_select_zones: true
    public_subnets:
      count_per_zone: 1
      subnet_size: '256'
    private_subnets:
      count_per_zone: 1
      subnet_size: '1024'
    database_subnets:
      count_per_zone: 1
      subnet_size: '256'
    nat_gateway:
      strategy: single
    firewall_rules:
      allow_internal: true
      allow_ssh: true
      allow_http: true
      allow_https: true
      allow_icmp: true
    private_google_access:
      enable_private_subnets: true
      enable_database_subnets: true
iac:
  validated_files:
  - main.tf
  - variables.tf
