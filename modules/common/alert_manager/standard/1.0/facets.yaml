intent: alert_manager
flavor: standard
version: '1.0'
description: Configure Alertmanager notification receivers and routing rules for alerts. Supports Slack, PagerDuty, Email, and Webhook integrations.
clouds:
  - kubernetes
  - aws
  - azure
  - gcp
inputs:
  kubernetes_cluster:
    type: '@facets/kubernetes-details'
    optional: false
    displayName: Kubernetes Cluster
    description: Kubernetes cluster for deploying AlertmanagerConfig
    providers:
      - kubernetes
      - kubernetes-alpha
  prometheus:
    type: '@facets/prometheus'
    optional: false
    displayName: Prometheus Instance
    description: Prometheus instance with Alertmanager
outputs:
  default:
    type: '@facets/alert-manager'
    title: Alertmanager Configuration
spec:
  title: Alertmanager Receiver Configuration
  description: Configure notification receivers and routing rules
  type: object
  properties:
    receivers:
      type: object
      title: Notification Receivers
      description: Define notification channels for alerts
      x-ui-toggle: true
      patternProperties:
        ^[a-zA-Z0-9_-]*$:
          type: object
          title: Receiver Configuration
          x-ui-order:
            - type
            - slack_config
            - pagerduty_config
            - email_config
            - webhook_config
          properties:
            type:
              type: string
              title: Receiver Type
              description: Type of notification channel
              enum:
                - slack
                - pagerduty
                - email
                - webhook
            slack_config:
              type: object
              title: Slack Configuration
              description: Slack webhook configuration
              x-ui-visible-if: "spec.receivers.{{this}}.type == 'slack'"
              x-ui-toggle: true
              x-ui-order:
                - api_url_secret
                - channel
                - title
                - text
              properties:
                api_url_secret:
                  type: string
                  title: Webhook URL Secret
                  description: Kubernetes secret name containing Slack webhook URL (key must be 'url')
                  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                  x-ui-placeholder: e.g., slack-webhook-secret
                channel:
                  type: string
                  title: Channel
                  description: Slack channel (must start with #)
                  pattern: ^#.*
                  x-ui-placeholder: e.g., #platform-alerts
                title:
                  type: string
                  title: Message Title
                  description: Alert title template (supports Go templating)
                  default: "{{ .GroupLabels.alertname }}"
                  x-ui-placeholder: "{{ .GroupLabels.alertname }}"
                text:
                  type: string
                  title: Message Text
                  description: Alert text template (supports Go templating)
                  default: "{{ range .Alerts }}{{ .Annotations.summary }}\n{{ end }}"
                  x-ui-yaml-editor: true
              required:
                - api_url_secret
                - channel
            pagerduty_config:
              type: object
              title: PagerDuty Configuration
              description: PagerDuty integration configuration
              x-ui-visible-if: "spec.receivers.{{this}}.type == 'pagerduty'"
              x-ui-toggle: true
              x-ui-order:
                - service_key_secret
                - severity
              properties:
                service_key_secret:
                  type: string
                  title: Service Key Secret
                  description: Kubernetes secret name containing PagerDuty integration key (key must be 'key')
                  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                  x-ui-placeholder: e.g., pagerduty-key-secret
                severity:
                  type: string
                  title: Incident Severity
                  description: Default severity for PagerDuty incidents
                  enum:
                    - critical
                    - error
                    - warning
                    - info
                  default: critical
              required:
                - service_key_secret
            email_config:
              type: object
              title: Email Configuration
              description: SMTP email configuration
              x-ui-visible-if: "spec.receivers.{{this}}.type == 'email'"
              x-ui-toggle: true
              x-ui-order:
                - to
                - from
                - smarthost
                - auth_secret
              properties:
                to:
                  type: string
                  title: To Address
                  description: Recipient email address
                  pattern: ^[^\s@]+@[^\s@]+\.[^\s@]+$
                  x-ui-placeholder: e.g., alerts@example.com
                from:
                  type: string
                  title: From Address
                  description: Sender email address
                  pattern: ^[^\s@]+@[^\s@]+\.[^\s@]+$
                  x-ui-placeholder: e.g., alertmanager@example.com
                smarthost:
                  type: string
                  title: SMTP Server
                  description: SMTP server address with port
                  pattern: ^[^:]+:[0-9]+$
                  x-ui-placeholder: e.g., smtp.gmail.com:587
                auth_secret:
                  type: string
                  title: Auth Credentials Secret
                  description: Kubernetes secret name containing SMTP username and password (keys must be 'username' and 'password')
                  pattern: ^[a-z0-9]([-a-z0-9]*[a-z0-9])?$
                  x-ui-placeholder: e.g., smtp-auth-secret
              required:
                - to
                - from
                - smarthost
                - auth_secret
            webhook_config:
              type: object
              title: Webhook Configuration
              description: Custom webhook endpoint configuration
              x-ui-visible-if: "spec.receivers.{{this}}.type == 'webhook'"
              x-ui-toggle: true
              x-ui-order:
                - url
                - http_method
              properties:
                url:
                  type: string
                  title: Webhook URL
                  description: HTTP endpoint to send alert notifications
                  pattern: ^https?://.*
                  x-ui-placeholder: https://webhook.example.com/alerts
                http_method:
                  type: string
                  title: HTTP Method
                  description: HTTP method for webhook request
                  enum:
                    - POST
                    - PUT
                  default: POST
              required:
                - url
          required:
            - type
    routes:
      type: object
      title: Routing Rules
      description: Route alerts to receivers based on label matching
      x-ui-toggle: true
      patternProperties:
        ^[a-zA-Z0-9_-]*$:
          type: object
          title: Route Configuration
          x-ui-order:
            - receiver
            - matchers
            - continue
            - group_by
            - group_wait
            - group_interval
            - repeat_interval
          properties:
            receiver:
              type: string
              title: Receiver Name
              description: Name of receiver from receivers section above
              x-ui-placeholder: e.g., slack_platform
            matchers:
              type: object
              title: Label Matchers
              description: Alert must match ALL of these labels (key-value pairs)
              x-ui-yaml-editor: true
              x-ui-placeholder: "severity: critical\nteam: platform"
            continue:
              type: boolean
              title: Continue Matching
              description: Continue evaluating subsequent routes after this one matches
              default: false
            group_by:
              type: array
              title: Group By Labels
              description: Group alerts by these labels
              items:
                type: string
              default:
                - alertname
            group_wait:
              type: string
              title: Group Wait
              description: How long to wait before sending notification for new alert group
              pattern: ^[0-9]+(s|m|h)$
              default: "30s"
              x-ui-placeholder: e.g., 30s, 1m
            group_interval:
              type: string
              title: Group Interval
              description: How long to wait before sending notification about new alerts in existing group
              pattern: ^[0-9]+(s|m|h)$
              default: "5m"
              x-ui-placeholder: e.g., 5m, 10m
            repeat_interval:
              type: string
              title: Repeat Interval
              description: How long to wait before re-sending notification for unresolved alerts
              pattern: ^[0-9]+(s|m|h)$
              default: "4h"
              x-ui-placeholder: e.g., 4h, 12h
          required:
            - receiver
            - matchers
  required:
    - receivers
    - routes
  x-ui-order:
    - receivers
    - routes
sample:
  kind: alert_manager
  flavor: standard
  version: '1.0'
  disabled: false
  spec:
    receivers:
      slack_platform:
        type: slack
        slack_config:
          api_url_secret: slack-webhook-secret
          channel: "#platform-alerts"
          title: "{{ .GroupLabels.alertname }}"
          text: "{{ range .Alerts }}{{ .Annotations.summary }}\n{{ end }}"
      pagerduty_oncall:
        type: pagerduty
        pagerduty_config:
          service_key_secret: pagerduty-key-secret
          severity: critical
    routes:
      critical_to_pagerduty:
        receiver: pagerduty_oncall
        matchers:
          severity: critical
        group_by:
          - alertname
          - service
        group_wait: "10s"
        repeat_interval: "1h"
        continue: false
      platform_to_slack:
        receiver: slack_platform
        matchers:
          team: platform
        group_by:
          - alertname
        group_wait: "30s"
        group_interval: "5m"
        repeat_interval: "4h"
        continue: true
