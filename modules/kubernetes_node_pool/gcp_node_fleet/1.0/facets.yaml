intent: kubernetes_node_pool
flavor: gcp_node_fleet
version: '1.0'
description: GCP GKE Node Fleet module for provisioning multiple node pools
intentDetails:
  type: compute
  description: GCP GKE node fleet for managing multiple node pools
  displayName: GCP Node Fleet
clouds:
  - gcp
inputs:
  cloud_account:
    type: '@facets/gcp_cloud_account'
    displayName: Cloud Account
    description: The GCP Cloud Account where the node fleet will be created
    optional: false
    providers:
      - google
      - google-beta
  network_details:
    type: '@facets/gcp-network-details'
    displayName: Network
    description: The GCP VPC network where the node fleet will be created
    optional: false
    default:
      resource_type: network
      resource_name: default
  kubernetes_details:
    type: '@facets/gke'
    displayName: GKE Cluster
    description: The GKE cluster where the node fleet will be added
    optional: false
    default:
      resource_type: kubernetes_cluster
      resource_name: default
    providers:
      - kubernetes
      - kubernetes-alpha
      - helm
outputs:
  default:
    type: '@facets/kubernetes_nodepool'
    title: GKE Node Fleet Output
    description: Basic output information for the GKE node fleet
  attributes:
    type: '@facets/gke_node_pool_details'
    title: GKE Node Fleet Details
    description: Detailed information about the GKE node fleet including configuration and status
spec:
  title: GKE Node Fleet
  description: Specification for provisioning multiple GKE node pools as a fleet
  type: object
  properties:
    node_pools:
      title: Node Pools
      description: Configuration for multiple node pools in the fleet
      type: object
      patternProperties:
        ^[a-zA-Z][a-zA-Z0-9_-]*$:
          title: Node Pool Configuration
          description: Individual node pool configuration
          type: object
          properties:
            instance_type:
              title: Instance Type
              description: Instance type for nodes in this node pool
              type: string
              x-ui-placeholder: e.g. 'e2-standard-2'
            min_node_count:
              title: Min Node Count
              description: Minimum number of nodes in this node pool
              type: integer
              minimum: 0
              maximum: 100
            max_node_count:
              title: Max Node Count
              description: Maximum number of nodes in this node pool
              type: integer
              minimum: 0
              maximum: 100
            disk_size:
              title: Disk Size
              description: Size of the disk in GiB for nodes in this node pool
              type: integer
              minimum: 50
              maximum: 1000
            disk_type:
              title: Disk Type
              description: Type of disk for nodes
              type: string
              default: pd-standard
              enum:
                - pd-standard
                - pd-ssd
                - pd-balanced
            is_public:
              title: Is Public
              description: Deploy this node pool in public subnets
              type: boolean
              default: false
            spot:
              title: Spot Instances
              description: Enable spot/preemptible instances for cost savings (~70% cheaper, but can be terminated)
              type: boolean
              default: false
            autoscaling_per_zone:
              title: Autoscaling Per Zone
              description: If true, min/max nodes apply per zone. If false, applies as total across all zones.
              type: boolean
              default: false
            single_az:
              title: Single AZ
              description: Deploy node pool in single availability zone (uses first zone from network configuration)
              type: boolean
              default: false
            azs:
              title: Availability Zones
              description: Specific zones for this node pool (optional)
              type: array
              items:
                type: string
              x-ui-override-disable: true
            iam:
              title: IAM Configuration
              description: IAM roles for this node pool
              type: object
              properties:
                roles:
                  title: IAM Roles
                  description: IAM roles to be assigned to node pool service account
                  type: object
                  patternProperties:
                    ^[a-zA-Z][a-zA-Z0-9_.-]*$:
                      title: Role Configuration
                      type: object
                      properties:
                        role:
                          title: Role
                          description: IAM role to assign
                          type: string
          required:
            - instance_type
            - min_node_count
            - max_node_count
            - disk_size
    labels:
      title: Fleet Labels
      description: Common labels applied to all node pools in the fleet
      type: object
      x-ui-yaml-editor: true
      x-ui-placeholder: 'key1: value1'
    taints:
      title: Taints
      description: Array of Kubernetes taints which should be applied to nodes in the node pool. Enter array of object in YAML format.
      type: array
      x-ui-yaml-editor: true
      x-ui-override-disable: true
      default:
        - key: CriticalAddonsOnly
          value: 'true'
          effect: NoSchedule
  required:
    - node_pools
iac:
  validated_files:
    - main.tf
    - variables.tf
sample:
  flavor: gcp_node_fleet
  version: '1.0'
  kind: kubernetes_node_pool
  metadata:
    name: example-fleet
  spec:
    node_pools:
      worker-pool:
        instance_type: e2-standard-2
        min_node_count: 1
        max_node_count: 5
        disk_size: 100
        disk_type: pd-standard
        is_public: false
        spot: false
        autoscaling_per_zone: false
        single_az: false
      spot-pool:
        instance_type: e2-standard-4
        min_node_count: 0
        max_node_count: 10
        disk_size: 100
        disk_type: pd-standard
        is_public: false
        spot: true
        autoscaling_per_zone: false
        single_az: false
    labels:
      fleet: example
    taints: []