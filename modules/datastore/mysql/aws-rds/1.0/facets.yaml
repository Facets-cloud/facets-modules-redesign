intent: mysql
flavor: aws-rds
version: '1.0'
clouds:
- aws
description: Managed MySQL database instance on AWS RDS with high availability, automated
  backups, and read replicas
intentDetails:
  type: data_storage
  description: AWS RDS MySQL managed database service
  displayName: MySQL (RDS)
spec:
  title: MySQL RDS Database
  description: Managed MySQL database instance on AWS RDS with high availability,
    automated backups, and read replicas
  type: object
  x-ui-order:
  - version_config
  - sizing
  - restore_config
  - imports
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      x-ui-order:
      - version
      - database_name
      properties:
        version:
          type: string
          title: MySQL Version
          description: Version of the MySQL database engine
          enum:
          - '5.7'
          - '8.0'
          - '8.4'
          default: '8.4'
        database_name:
          type: string
          title: Database Name
          description: Initial database to create
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 64
          default: myapp
    sizing:
      type: object
      title: Sizing & Performance
      x-ui-order:
      - instance_class
      - allocated_storage
      - max_allocated_storage
      - storage_type
      - read_replica_count
      properties:
        instance_class:
          type: string
          title: Instance Class
          description: RDS instance class for performance and capacity
          enum:
          - db.t3.micro
          - db.t3.small
          - db.t3.medium
          - db.t3.large
          - db.m5.large
          - db.m5.xlarge
          - db.m5.2xlarge
          default: db.t3.small
        allocated_storage:
          type: number
          title: Allocated Storage (GB)
          description: Initial storage allocation in GB
          minimum: 20
          maximum: 65536
          default: 100
        max_allocated_storage:
          type: number
          title: Max Storage (GB)
          description: Maximum storage for autoscaling (0 to disable)
          minimum: 0
          maximum: 65536
          default: 1000
        storage_type:
          type: string
          title: Storage Type
          description: Storage type for the database
          enum:
          - gp2
          - gp3
          - io1
          - io2
          default: gp3
        read_replica_count:
          type: number
          title: Read Replica Count
          description: Number of read replicas to create
          minimum: 0
          maximum: 5
          default: 0
    restore_config:
      type: object
      title: Restore Operations
      x-ui-overrides-only: true
      x-ui-order:
      - restore_from_backup
      - source_db_instance_identifier
      - restore_master_username
      - restore_master_password
      properties:
        restore_from_backup:
          type: boolean
          title: Restore from Backup
          description: Restore database from existing backup or snapshot
          default: false
        source_db_instance_identifier:
          type: string
          title: Source DB Instance
          description: Source database instance identifier for restore
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        restore_master_username:
          type: string
          title: Restore Master Username
          description: Master username for restored database (required for restore
            operations)
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 16
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        restore_master_password:
          type: string
          title: Restore Master Password
          description: Master password for restored database (required for restore
            operations)
          minLength: 8
          maxLength: 128
          pattern: ^[a-zA-Z0-9!@#$%^&*()_+=\-]{8,128}$
          x-ui-error-message: "Password must be 8-128 chars with valid characters."
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
    imports:
      type: object
      title: Import Existing Resources
      x-ui-overrides-only: true
      x-ui-order:
      - import_existing
      - db_instance_identifier
      - db_subnet_group_name
      properties:
        import_existing:
          type: boolean
          title: Import Existing Resources
          description: Enable to import existing AWS RDS resources
          default: false
        db_instance_identifier:
          type: string
          title: DB Instance Identifier
          description: Identifier of existing RDS instance to import
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        db_subnet_group_name:
          type: string
          title: DB Subnet Group Name
          description: Name of existing DB subnet group to import
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        security_group_id:
          type: string
          title: Security Group ID
          description: ID of existing security group to import
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        master_password:
          type: string
          title: Master Password
          description: Master password for the imported resource (8+ characters)
          minLength: 8
          pattern: ^[a-zA-Z0-9!@#$%^&*()_+=\-]{8,}$
          x-ui-error-message: "Password must be 8+ chars with valid characters."
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
  required:
  - version_config
imports:
- name: db_instance_identifier
  resource_address: aws_db_instance.mysql
  required: true
- name: db_subnet_group_name
  resource_address: aws_db_subnet_group.mysql
  required: false
- name: security_group_id
  resource_address: aws_security_group.mysql
  required: false
- name: master_password
  resource_address: random_password.master_password[0]
  required: true
inputs:
  aws_cloud_account:
    type: '@facets/aws_cloud_account'
    optional: false
    displayName: AWS Cloud Account
    description: AWS cloud account configuration for provider setup
    providers:
    - aws
  vpc_details:
    type: '@facets/aws-vpc-details'
    optional: false
    displayName: VPC Network Details
    description: VPC configuration for database networking
outputs:
  default:
    type: '@facets/mysql'
    title: MySQL RDS Instance
iac:
  validated_files:
  - main.tf
  - variables.tf
  - locals.tf
sample:
  kind: mysql
  flavor: aws-rds
  version: '1.0'
  disabled: true
  spec:
    version_config:
      version: '8.4'
      database_name: myapp
    sizing:
      instance_class: db.t3.small
      allocated_storage: 100
      max_allocated_storage: 1000
      storage_type: gp3
      read_replica_count: 0
    restore_config:
      restore_from_backup: false
