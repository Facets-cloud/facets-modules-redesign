intent: redis
flavor: azure_cache_custom
version: '1.0'
clouds:
- azure
description: Custom Azure Cache for Redis - A fully managed in-memory cache service
  built on open-source Redis, offering high performance and scalability for Azure
  applications.
intentDetails:
  type: Datastores
  description: Azure Cache for Redis managed service
  displayName: Redis
  iconUrl: https://raw.githubusercontent.com/Facets-cloud/facets-modules-redesign/main/icons/redis.svg
spec:
  title: Custom Azure Cache for Redis
  description: Configure Azure Cache for Redis with developer-friendly settings
  type: object
  x-ui-order:
  - version_config
  - sizing
  - imports
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      x-ui-order:
      - redis_version
      - family
      properties:
        redis_version:
          type: string
          title: Redis Version
          description: Redis version to use (4.0, 6.0 supported)
          enum:
          - '4'
          - '6'
          default: '6'
        family:
          type: string
          title: Redis Family
          description: Redis cache family (Basic, Standard, Premium)
          enum:
          - C
          - P
          default: P
          x-ui-error-message: Family must be C (Basic/Standard) or P (Premium)
      required:
      - redis_version
      - family
    sizing:
      type: object
      title: Sizing & Performance
      x-ui-order:
      - sku_name
      - capacity
      - replicas_per_master
      - replicas_per_primary
      - shard_count
      properties:
        sku_name:
          type: string
          title: SKU Name
          description: Cache SKU defining performance tier (Premium required for VNet
            integration and automatic backups)
          enum:
          - Basic
          - Standard
          - Premium
          default: Premium
          x-ui-error-message: Premium SKU is required for VNet integration and automatic
            backups
        capacity:
          type: number
          title: Cache Capacity
          description: Cache size/capacity (0-6 for Basic/Standard, 1-5 for Premium)
          minimum: 0
          maximum: 6
          default: 1
        replicas_per_master:
          type: number
          title: Replicas per Master
          description: Number of replicas per master (Premium only)
          minimum: 1
          maximum: 3
          default: 1
          x-ui-visible-if:
            field: spec.version_config.family
            values:
            - P
        replicas_per_primary:
          type: number
          title: Replicas per Primary
          description: Number of replicas per primary node (Premium only)
          minimum: 1
          maximum: 3
          default: 1
          x-ui-visible-if:
            field: spec.version_config.family
            values:
            - P
        shard_count:
          type: number
          title: Shard Count
          description: Number of shards for Premium clustered cache
          minimum: 1
          maximum: 10
          default: 1
          x-ui-visible-if:
            field: spec.version_config.family
            values:
            - P
      required:
      - sku_name
      - capacity
    imports:
      type: object
      title: Import Existing Cache (Terraform State Only)
      description: Import an existing Azure Redis Cache into Terraform state management
      x-ui-overrides-only: true
      x-ui-order:
      - import_existing
      - cache_resource_id
      - firewall_rule_resource_id
      properties:
        import_existing:
          type: boolean
          title: Import Existing Resources
          description: Enable to import existing Azure Redis Cache resources
          default: false
        cache_resource_id:
          type: string
          title: Redis Cache Resource ID
          description: Full Azure resource ID of existing cache (format:/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.Cache/redis/{name})
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        firewall_rule_resource_id:
          type: string
          title: Firewall Rule Resource ID (Optional)
          description: Full Azure resource ID of firewall rule (format:/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.Cache/Redis/{cacheName}/firewallRules/{ruleName})
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
  required:
  - version_config
  - sizing
inputs:
  azure_provider:
    type: '@facets/azure_cloud_account'
    optional: false
    displayName: Azure Cloud Account
    description: Azure cloud provider configuration
    providers:
    - azurerm
  network_details:
    type: '@facets/azure-network-details'
    optional: false
    displayName: Azure Network Details
    description: Azure VNet and subnet configuration for cache deployment
outputs:
  default:
    type: '@facets/redis'
    title: Custom Azure Cache for Redis
imports:
- name: cache_resource_id
  resource_address: azurerm_redis_cache.main
  required: false
- name: firewall_rule_resource_id
  resource_address: azurerm_redis_firewall_rule.vnet_access[0]
  required: false
iac:
  validated_files:
  - main.tf
  - variables.tf
  - outputs.tf
sample:
  kind: redis
  flavor: azure_cache_custom
  version: '1.0'
  disabled: true
  spec:
    version_config:
      redis_version: '6'
      family: P
    sizing:
      sku_name: Premium
      capacity: 1
