intent: mongo
flavor: aws-documentdb
version: '1.0'
clouds:
- aws
description: MongoDB-compatible database using AWS DocumentDB service
intentDetails:
  type: data_storage
  description: AWS DocumentDB MongoDB-compatible database service
  displayName: MongoDB
  iconUrl: https://raw.githubusercontent.com/Facets-cloud/facets-modules-redesign/main/icons/mongo.svg
spec:
  title: MongoDB with AWS DocumentDB
  description: MongoDB-compatible database using AWS DocumentDB service
  type: object
  x-ui-order:
  - version_config
  - sizing
  - restore_config
  - imports
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      x-ui-order:
      - engine_version
      - port
      properties:
        engine_version:
          type: string
          title: DocumentDB Engine Version
          description: DocumentDB engine version
          enum:
          - 4.0.0
          - 5.0.0
          - 6.0.0
          default: 4.0.0
        port:
          type: number
          title: Port
          description: Port number for DocumentDB cluster
          minimum: 1024
          maximum: 65535
          default: 27017
    sizing:
      type: object
      title: Sizing & Performance
      x-ui-order:
      - instance_class
      - instance_count
      properties:
        instance_class:
          type: string
          title: Instance Class
          description: DocumentDB instance class
          enum:
          - db.t3.medium
          - db.t4g.medium
          - db.r5.large
          - db.r5.xlarge
          - db.r6g.large
          - db.r6g.xlarge
          default: db.t4g.medium
        instance_count:
          type: number
          title: Instance Count
          description: Number of instances in the DocumentDB cluster
          minimum: 1
          maximum: 16
          default: 1
    restore_config:
      type: object
      title: Restore Operations
      x-ui-overrides-only: true
      x-ui-order:
      - restore_from_snapshot
      - snapshot_identifier
      - master_username
      - master_password
      properties:
        restore_from_snapshot:
          type: boolean
          title: Restore from Snapshot
          description: Restore DocumentDB cluster from existing snapshot
          default: false
        snapshot_identifier:
          type: string
          title: Snapshot Identifier
          description: DocumentDB snapshot identifier for restore
          x-ui-visible-if:
            field: spec.restore_config.restore_from_snapshot
            values:
            - true
        master_username:
          type: string
          title: Master Username
          description: Master username for restored cluster
          default: docdbadmin
          x-ui-visible-if:
            field: spec.restore_config.restore_from_snapshot
            values:
            - true
        master_password:
          type: string
          title: Master Password
          description: Master password for restored cluster (8+ characters)
          minLength: 8
          pattern: ^[a-zA-Z0-9!@#$%^&*()_+=\-]{8,}$
          x-ui-error-message: "Password must be 8+ chars with valid characters."
          x-ui-visible-if:
            field: spec.restore_config.restore_from_snapshot
            values:
            - true
    imports:
      type: object
      title: Import Existing Resources
      x-ui-overrides-only: true
      x-ui-order:
      - import_existing
      - cluster_identifier
      - security_group_id
      - subnet_group_name
      - master_password
      properties:
        import_existing:
          type: boolean
          title: Import Existing Resources
          description: Enable to import existing DocumentDB resources
          default: false
        cluster_identifier:
          type: string
          title: Cluster Identifier
          description: Existing DocumentDB cluster identifier to import
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        security_group_id:
          type: string
          title: Security Group ID
          description: ID of existing security group to import (e.g., sg-1234567890abcdef0)
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        subnet_group_name:
          type: string
          title: Subnet Group Name
          description: Name of existing DocumentDB subnet group to import
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        master_password:
          type: string
          title: Master Password
          description: Master password for the imported cluster (8+ characters)
          minLength: 8
          pattern: ^[a-zA-Z0-9!@#$%^&*()_+=\-]{8,}$
          x-ui-error-message: "Password must be 8+ chars with valid characters."
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
  required:
  - version_config
  - sizing
inputs:
  aws_provider:
    type: '@facets/aws_cloud_account'
    optional: false
    displayName: AWS Provider
    description: AWS cloud account configuration
    providers:
    - aws
  vpc_details:
    type: '@facets/aws-vpc-details'
    optional: false
    displayName: VPC Details
    description: VPC configuration for DocumentDB cluster
outputs:
  default:
    type: '@facets/mongo'
    title: MongoDB DocumentDB Cluster
imports:
- name: cluster_identifier
  resource_address: aws_docdb_cluster.main
  required: true
- name: security_group_id
  resource_address: aws_security_group.documentdb
  required: true
- name: subnet_group_name
  resource_address: aws_docdb_subnet_group.main
  required: true
- name: master_password
  resource_address: random_password.master[0]
  required: true
iac:
  validated_files:
  - main.tf
  - variables.tf
  - locals.tf
sample:
  kind: mongo
  flavor: aws-documentdb
  version: '1.0'
  disabled: true
  spec:
    version_config:
      engine_version: 4.0.0
      port: 27017
    sizing:
      instance_class: db.t4g.medium
      instance_count: 1
