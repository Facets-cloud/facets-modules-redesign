intent: postgres
flavor: kubeblocks
version: '1.0'
clouds:
- kubernetes
- aws
- azure
- gcp
description: Creates and manages PostgreSQL database clusters using KubeBlocks operator
  v1.0.1
intentDetails:
  type: data_storage
  description: KubeBlocks-managed PostgreSQL database on Kubernetes
  displayName: PostgreSQL
inputs:
  kubeblocks_operator:
    type: '@facets/kubeblocks-operator'
    optional: false
    displayName: KubeBlocks Operator
    description: KubeBlocks operator installation (CRDs must be ready)
  kubernetes_cluster:
    type: '@facets/kubernetes-details'
    optional: false
    displayName: Kubernetes Cluster
    description: Target Kubernetes cluster
    providers:
    - kubernetes
    - helm
  node_pool:
    type: '@facets/kubernetes_nodepool'
    optional: false
    displayName: Node Pool
    description: Node pool for PostgreSQL pods
spec:
  title: PostgreSQL Cluster Configuration
  description: PostgreSQL database cluster managed by KubeBlocks
  type: object
  x-ui-order:
  - namespace_override
  - termination_policy
  - postgres_version
  - mode
  - replicas
  - resources
  - storage
  - backup
  - restore
  properties:
    namespace_override:
      type: string
      title: Namespace Override
      description: (Optional) Specify a custom namespace for the cluster. If not set,
        the namespace from the environment will be used.
      default: ''
    termination_policy:
      type: string
      title: Termination Policy
      description: Controls cluster deletion behavior
      enum:
      - DoNotTerminate
      - Delete
      - WipeOut
      default: Delete
      x-enum-descriptions:
        Delete: Delete pods and PVCs
        DoNotTerminate: Block cluster deletion
        WipeOut: Delete everything including backups
    postgres_version:
      type: string
      title: PostgreSQL Version
      description: PostgreSQL major version to deploy
      enum:
      - 12.15.0
      - 14.8.0
      - 15.7.0
      - 16.4.0
      default: 16.4.0
    mode:
      type: string
      title: Cluster Mode
      description: Deployment mode - standalone for single instance, replication for
        high availability
      enum:
      - standalone
      - replication
      default: replication
    replicas:
      type: integer
      title: Number of Replicas
      description: Number of PostgreSQL instances (only for replication mode)
      default: 2
      minimum: 1
      maximum: 5
      x-ui-visible-if:
        field: spec.mode
        values:
        - replication
    resources:
      type: object
      title: Resource Allocation
      description: CPU and memory resources for PostgreSQL pods
      x-ui-order:
      - cpu_request
      - cpu_limit
      - memory_request
      - memory_limit
      properties:
        cpu_request:
          type: string
          title: CPU Request
          description: Minimum CPU allocation
          default: 500m
        cpu_limit:
          type: string
          title: CPU Limit
          description: Maximum CPU allocation
          default: 1000m
        memory_request:
          type: string
          title: Memory Request
          description: Minimum memory allocation
          default: 512Mi
        memory_limit:
          type: string
          title: Memory Limit
          description: Maximum memory allocation
          default: 1Gi
    storage:
      type: object
      title: Storage Configuration
      description: Persistent storage settings for PostgreSQL data
      x-ui-order:
      - size
      properties:
        size:
          type: string
          title: Storage Size
          description: Size of persistent volume (can be expanded later, cannot be
            reduced)
          default: 20Gi
      required:
      - size
    backup:
      type: object
      title: Backup Configuration
      description: Optional backup repository and schedule configuration
      x-ui-overrides-only: true
      x-ui-order:
      - enabled
      - schedule_cron
      - retention_period
      properties:
        enabled:
          type: boolean
          title: Enable Backup
          description: Enable backup configuration for this cluster
          default: false
        schedule_cron:
          type: string
          title: Backup Schedule (Cron)
          description: Cron expression for backup schedule (e.g., "0 2 * * *" for
            daily at 2 AM)
          default: 0 2 * * *
        retention_period:
          type: string
          title: Backup Retention Period
          description: How long to retain backups (e.g., "7d", "30d", "1y")
          default: 7d
    restore:
      type: object
      title: Restore Configuration
      description: Restore cluster from existing backup instead of creating fresh
        cluster
      x-ui-overrides-only: true
      x-ui-order:
      - enabled
      properties:
        enabled:
          type: boolean
          title: Enable Restore
          description: Restore from backup instead of creating fresh cluster
          default: false
        backup_name:
          type: string
          title: Backup Name
          description: Name of the backup to restore from (e.g., 'pg-cluster-backup-20250125')
          x-ui-visible-if:
            field: spec.restore.enabled
            values:
            - true
          x-ui-required-if:
            field: spec.restore.enabled
            values:
            - true
  required:
  - postgres_version
  - mode
outputs:
  default:
    type: '@facets/postgres'
    title: PostgreSQL Cluster Credentials
iac:
  validated_files:
  - main.tf
  - variables.tf
  - outputs.tf
  - locals.tf
sample:
  kind: postgres
  flavor: kubeblocks
  version: '1.0'
  disabled: true
  spec:
    namespace_override: ''
    termination_policy: Delete
    postgres_version: 16.4.0
    mode: replication
    replicas: 2
    resources:
      cpu_request: 500m
      cpu_limit: 1000m
      memory_request: 512Mi
      memory_limit: 1Gi
    storage:
      size: 20Gi
    backup:
      enabled: false
      schedule_cron: 0 2 * * *
      retention_period: 7d
    restore:
      enabled: false
      backup_name: ''
