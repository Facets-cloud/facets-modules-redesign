intent: dynamodb
flavor: astuto
version: '1.0'
clouds:
  - aws
description: DynamoDB module with enhanced configuration options

inputs:
  cloud_account:
    description: The AWS cloud account where DynamoDB table will be created
    displayName: AWS Cloud Account
    optional: false
    providers:
      - aws
    type: '@facets/aws_cloud_account'

spec:
  title: DynamoDB
  description: AWS DynamoDB table with support for advanced configuration options
  type: object
  properties:
    attributes:
      type: object
      title: Attributes
      description: Map of DynamoDB attributes
      default: {}
      patternProperties:
        ^[a-zA-Z][a-zA-Z0-9._-]*[a-zA-Z0-9]$:
          type: object
          title: Attribute Object
          description: Name of the attribute object
          properties:
            name:
              type: string
              title: Attribute Name
              description: Name of the attribute
            type:
              type: string
              title: Attribute Type
              description: Type of the attribute
              enum:
                - S
                - N
                - B
              default: S
          required:
            - name
            - type
    hash_key:
      type: string
      title: Hash Key
      description: The attribute to use as the hash (partition) key
      default: id
    range_key:
      type: string
      title: Range Key
      description: The attribute to use as the range (sort) key
    billing_mode:
      type: string
      title: Billing Mode
      description: Controls how you are charged for read and write throughput
      enum:
        - PROVISIONED
        - PAY_PER_REQUEST
      default: PAY_PER_REQUEST
    global_secondary_indexes:
      type: object
      title: Global Secondary Indexes
      description: Map of Global Secondary Index configurations
      default: {}
      x-ui-toggle: true
      patternProperties:
        ^[a-zA-Z][a-zA-Z0-9._-]*[a-zA-Z0-9]$:
          type: object
          title: Global Secondary Index
          description: Configuration for a Global Secondary Index
          properties:
            name:
              type: string
              title: Index Name
              description: The name of the Global Secondary Index
            hash_key:
              type: string
              title: Hash Key
              description: The name of the hash key in the index
            range_key:
              type: string
              title: Range Key
              description: The name of the range key in the index
            read_capacity:
              type: number
              title: Read Capacity
              description: The number of read units for this index (only required for PROVISIONED billing mode)
              minimum: 1
            write_capacity:
              type: number
              title: Write Capacity
              description: The number of write units for this index (only required for PROVISIONED billing mode)
              minimum: 1
          required:
            - name
            - hash_key
    point_in_time_recovery_enabled:
      type: boolean
      title: Enable Point-in-time Recovery
      description: Whether point-in-time recovery is enabled for the table
      default: false
    stream_enabled:
      type: boolean
      title: Enable DynamoDB Stream
      description: Indicates whether DynamoDB Streams is enabled on the table
      default: false
    tags:
      type: object
      title: Resource Tags
      description: Map of tags to assign to the resources
      x-ui-yaml-editor: true
  required:
    - hash_key
    - attributes

sample:
  kind: dynamodb
  flavor: astuto
  version: '1.0'
  disabled: false
  spec:
    attributes:
      attr1:
        name: id
        type: S
      attr2:
        name: email
        type: S
    billing_mode: PAY_PER_REQUEST
    hash_key: id
    global_secondary_indexes: {}
    point_in_time_recovery_enabled: false
    stream_enabled: false

outputs:
  default:
    type: '@facets/dynamodb'
    title: DynamoDB Table Output
    description: DynamoDB table details and IAM policy ARNs

iac:
  validated_files:
    - variables.tf
    - main.tf
    - locals.tf
    - outputs.tf
