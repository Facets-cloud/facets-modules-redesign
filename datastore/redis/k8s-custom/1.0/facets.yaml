intent: postgres
flavor: k8s-custom
version: '1.0'
clouds:
- kubernetes
description: PostgreSQL database deployed on Kubernetes using Helm chart with configurable
  storage and high availability options
spec:
  title: PostgreSQL on Kubernetes
  description: PostgreSQL database deployed on Kubernetes using Helm chart with configurable
    storage and high availability options
  type: object
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      properties:
        version:
          type: string
          title: PostgreSQL Version
          description: Version of PostgreSQL engine
          enum:
          - '13'
          - '14'
          - '15'
          - '16'
          default: '16'
        database_name:
          type: string
          title: Database Name
          description: Name of the default database to create
          default: postgres
          pattern: ^[a-zA-Z][a-zA-Z0-9_]{0,62}$
        username:
          type: string
          title: Master Username
          description: Master username for PostgreSQL
          default: postgres
          pattern: ^[a-zA-Z][a-zA-Z0-9_]{0,62}$
    sizing:
      type: object
      title: Sizing & Performance
      properties:
        architecture:
          type: string
          title: Architecture
          description: PostgreSQL deployment architecture
          enum:
          - standalone
          - replication
          default: standalone
        primary_resources:
          type: object
          title: Primary Instance Resources
          properties:
            cpu:
              type: string
              title: CPU Request
              description: CPU resource request for primary instance
              default: 250m
            memory:
              type: string
              title: Memory Request
              description: Memory resource request for primary instance
              default: 256Mi
            cpu_limit:
              type: string
              title: CPU Limit
              description: CPU resource limit for primary instance
              default: 1000m
            memory_limit:
              type: string
              title: Memory Limit
              description: Memory resource limit for primary instance
              default: 1Gi
        read_replica_count:
          type: number
          title: Read Replica Count
          description: Number of read replicas to create (only for replication architecture)
          minimum: 0
          maximum: 5
          default: 0
          x-ui-visible-if:
            field: spec.sizing.architecture
            values:
            - replication
        storage:
          type: object
          title: Storage Configuration
          properties:
            size:
              type: string
              title: Storage Size
              description: Persistent volume size
              default: 8Gi
              pattern: ^[0-9]+(Ki|Mi|Gi|Ti|Pi|Ei|k|M|G|T|P|E)$
            storage_class:
              type: string
              title: Storage Class
              description: Kubernetes storage class name (leave empty for default)
              default: ''
    restore_config:
      type: object
      title: Restore Operations
      properties:
        restore_from_backup:
          type: boolean
          title: Restore from Backup
          description: Restore database from existing backup
          default: false
        backup_source:
          type: object
          title: Backup Source Configuration
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
          properties:
            source_type:
              type: string
              title: Backup Source Type
              description: Type of backup source
              enum:
              - s3
              - gcs
              - pvc
              default: s3
            source_path:
              type: string
              title: Backup Path
              description: Path to backup files (S3 URI, GCS path, or PVC path)
        master_password:
          type: string
          title: Master Password
          description: Master password for restored database (required for restore
            operations)
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
          x-ui-secret-ref: true
    imports:
      type: object
      title: Import Existing Resources
      properties:
        helm_release_name:
          type: string
          title: Helm Release Name
          description: Name of existing Helm release to import
        namespace:
          type: string
          title: Kubernetes Namespace
          description: Namespace of existing PostgreSQL deployment
        primary_service_name:
          type: string
          title: Primary Service Name
          description: Name of existing primary PostgreSQL service
        secret_name:
          type: string
          title: Secret Name
          description: Name of existing secret containing PostgreSQL credentials
  required:
  - version_config
  - sizing
imports:
- name: helm_release_name
  resource_address: helm_release.postgresql
  required: true
inputs:
  kubernetes_cluster:
    type: '@facets/kubernetes-details'
    optional: false
    displayName: Kubernetes Cluster
    description: Target Kubernetes cluster for PostgreSQL deployment
    providers:
    - kubernetes
    - helm
outputs:
  default:
    type: '@facets/postgres-k8s-custom'
    title: PostgreSQL on Kubernetes Details
  interfaces:
    type: '@facets/postgres-interface'
    title: PostgreSQL Database Interface
iac:
  validated_files:
  - main.tf
  - variables.tf
  - locals.tf
sample:
  kind: postgres
  flavor: k8s-custom
  version: '1.0'
  disabled: true
  spec:
    version_config:
      version: '16'
      database_name: postgres
      username: postgres
    sizing:
      architecture: standalone
      primary_resources:
        cpu: 250m
        memory: 256Mi
        cpu_limit: 1000m
        memory_limit: 1Gi
      storage:
        size: 8Gi
