intent: postgres
flavor: aws-rds
version: '1.0'
clouds:
- aws
description: Managed PostgreSQL database using Amazon RDS with secure defaults and
  backup support
spec:
  title: PostgreSQL RDS Database
  description: Managed PostgreSQL database using Amazon RDS with secure defaults and
    backup support
  type: object
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      properties:
        engine_version:
          type: string
          title: PostgreSQL Version
          description: Version of the PostgreSQL database engine
          enum:
          - '13.15'
          - '14.12'
          - '15.7'
          default: '15.7'
        database_name:
          type: string
          title: Database Name
          description: Name of the initial database to create
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 63
          default: postgres
      required:
      - engine_version
      - database_name
    sizing:
      type: object
      title: Sizing & Performance
      properties:
        instance_class:
          type: string
          title: Instance Class
          description: Database instance class
          enum:
          - db.t3.micro
          - db.t3.small
          - db.t3.medium
          - db.m5.large
          - db.m5.xlarge
          default: db.t3.small
        allocated_storage:
          type: number
          title: Allocated Storage (GB)
          description: Initial storage allocation in GB
          minimum: 20
          maximum: 65536
          default: 100
        read_replica_count:
          type: number
          title: Read Replica Count
          description: Number of read replicas to create
          minimum: 0
          maximum: 5
          default: 0
      required:
      - instance_class
      - allocated_storage
      - read_replica_count
    security_config:
      type: object
      title: Security & Protection
      properties:
        deletion_protection:
          type: boolean
          title: Enable Deletion Protection
          description: Protect database from accidental deletion (recommended for
            production)
          default: false
      required:
      - deletion_protection
    restore_config:
      type: object
      title: Restore Operations
      x-ui-overrides-only: true
      properties:
        restore_from_backup:
          type: boolean
          title: Restore from Backup
          description: Restore database from existing backup
          default: false
        source_db_instance_identifier:
          type: string
          title: Source DB Instance Identifier
          description: Source database instance identifier for restore
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        master_username:
          type: string
          title: Master Username
          description: Required when restoring from backup
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 63
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
        master_password:
          type: string
          title: Master Password
          description: Required when restoring from backup
          minLength: 8
          maxLength: 128
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
      required:
      - restore_config
    imports:
      type: object
      title: Import Existing Resources
      x-ui-overrides-only: true
      properties:
        db_instance_identifier:
          type: string
          title: RDS Instance Identifier
          description: Identifier of existing RDS instance to import (main or replica)
          pattern: ^[a-zA-Z][a-zA-Z0-9-]*$
          minLength: 1
          maxLength: 63
        subnet_group_name:
          type: string
          title: DB Subnet Group Name
          description: Name of existing DB subnet group (required when importing)
          pattern: ^[a-zA-Z][a-zA-Z0-9-]*$
          minLength: 1
          maxLength: 255
        security_group_id:
          type: string
          title: Security Group ID
          description: ID of existing security group (required when importing)
          pattern: ^sg-[0-9a-fA-F]{8,17}$
        master_password:
          type: string
          title: Master Password
          description: Master password for the imported cluster (8+ characters)
          minLength: 8
  required:
  - version_config
  - sizing
  - security_config
  - restore_config
imports:
- name: db_instance_identifier
  resource_address: aws_db_instance.postgres
  required: false
- name: subnet_group_name
  resource_address: aws_db_subnet_group.postgres
  required: false
- name: security_group_id
  resource_address: aws_security_group.postgres
  required: false
- name: master_password
  resource_address: random_password.master_password[0]
  required: true
inputs:
  aws_provider:
    type: '@facets/aws_cloud_account'
    optional: false
    displayName: AWS Cloud Account
    description: AWS cloud account configuration and provider
    providers:
    - aws
  vpc_details:
    type: '@facets/aws-vpc-details'
    optional: false
    displayName: VPC Infrastructure
    description: AWS VPC infrastructure for database deployment
outputs:
  default:
    type: '@facets/postgres'
    title: PostgreSQL RDS Instance
iac:
  validated_files:
  - main.tf
  - variables.tf
  - outputs.tf
sample:
  kind: postgres
  flavor: aws-rds
  version: '1.0'
  disabled: true
  spec:
    version_config:
      engine_version: '15.7'
      database_name: postgres
    sizing:
      instance_class: db.t3.small
      allocated_storage: 100
      read_replica_count: 0
    security_config:
      deletion_protection: false
    restore_config:
      restore_from_backup: false
