intent: kafka-topic
flavor: gcp-msk
version: '1.0'
clouds:
- gcp
description: Creates and manages topics for GCP Managed Service for Apache Kafka with configurable partitions, replication, and retention policies

spec:
  title: GCP Managed Kafka Topic
  description: Configure Kafka topic with partitions, replication, and optional configurations
  type: object
  properties:
    topic_id:
      type: string
      title: Topic ID
      description: The ID to use for the topic (e.g., 'my-topic', 'orders', 'user-events')
      pattern: '^[a-z0-9]([-a-z0-9]*[a-z0-9])?$'
    
    partition_count:
      type: integer
      title: Partition Count
      description: Number of partitions (can be increased but not decreased after creation)
      minimum: 1
      maximum: 1000
      default: 1
    
    replication_factor:
      type: integer
      title: Replication Factor
      description: Number of replicas for high availability (3 recommended for production)
      minimum: 1
      maximum: 5
      default: 3
    
    configs:
      type: object
      title: Topic Configurations
      description: Kafka topic configuration overrides as key-value pairs (e.g., cleanup.policy=compact, compression.type=producer, retention.ms=604800000)
      x-ui-editor: true
  
  required:
  - topic_id
  - partition_count
  - replication_factor

inputs:
  gcp_cloud_account:
    type: '@facets/gcp_cloud_account'
    optional: false
    displayName: GCP Cloud Account
    description: GCP cloud account configuration and credentials
    providers:
    - google
    - google-beta
  vpc_network:
    type: '@facets/gcp-network-details'
    optional: false
    displayName: VPC Network
    description: VPC network configuration for Kafka cluster deployment
  kafka_cluster:
    type: '@facets/gcp-msk'
    optional: false
    displayName: Kafka Cluster
    description: GCP Managed Kafka cluster where the topic will be created
    providers:
    - google
    - google-beta

outputs:
  default:
    type: '@facets/gcp-kafka-topic'
    title: Kafka Topic Details

iac:
  validated_files:
  - main.tf
  - variables.tf
  - outputs.tf

sample:
  kind: kafka
  flavor: gcp-kafka-topic
  version: '1.0'
  spec:
    topic_id: sample-topic
    partition_count: 2
    replication_factor: 3
    configs:
      cleanup.policy: compact
      compression.type: producer
      retention.ms: "604800000"
      max.message.bytes: "1048576"
      min.insync.replicas: "2"