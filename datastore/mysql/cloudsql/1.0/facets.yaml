intent: mysql
flavor: gcp-cloudsql
version: '1.0'
clouds:
- gcp
description: Managed MySQL database using Google Cloud SQL with automated backups
  and high availability
spec:
  title: MySQL CloudSQL Instance
  description: Managed MySQL database using Google Cloud SQL with automated backups
    and high availability
  type: object
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      properties:
        version:
          type: string
          title: MySQL Version
          description: MySQL database engine version
          enum:
          - '5.7'
          - '8.0'
          - '8.4'
          default: '8.0'
        database_name:
          type: string
          title: Initial Database Name
          description: Name of the initial database to create
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 64
          default: app_db
      required:
      - version
      - database_name
    sizing:
      type: object
      title: Sizing & Performance
      properties:
        tier:
          type: string
          title: Machine Type
          description: CloudSQL machine type for the instance
          enum:
          - db-f1-micro
          - db-g1-small
          - db-n1-standard-1
          - db-n1-standard-2
          - db-n1-standard-4
          - db-n1-highmem-2
          - db-n1-highmem-4
          default: db-n1-standard-1
        disk_size:
          type: number
          title: Storage Size (GB)
          description: Initial storage allocation in GB
          minimum: 10
          maximum: 30720
          default: 100
        read_replica_count:
          type: number
          title: Read Replica Count
          description: Number of read replicas to create
          minimum: 0
          maximum: 5
          default: 0
      required:
      - tier
      - disk_size
    restore_config:
      type: object
      title: Restore Operations
      properties:
        restore_from_backup:
          type: boolean
          title: Restore from Backup
          description: Restore database from existing CloudSQL backup or instance
          default: false
        source_instance_id:
          type: string
          title: Source Instance ID
          description: Source CloudSQL instance identifier for restore operations
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        master_username:
          type: string
          title: Master Username
          description: Username for the master user (required for restore operations)
          pattern: ^[a-zA-Z][a-zA-Z0-9_]*$
          minLength: 1
          maxLength: 32
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        master_password:
          type: string
          title: Master Password
          description: Password for the master user (required for restore operations)
          minLength: 8
          x-ui-secret-ref: true
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
    imports:
      type: object
      title: Import Existing Resources
      x-ui-toggle: true
      properties:
        instance_name:
          type: string
          title: CloudSQL Instance Name
          description: Name of existing CloudSQL instance to import
          pattern: ^[a-z]([a-z0-9-]*[a-z0-9])?$
          minLength: 1
          maxLength: 98
  required:
  - version_config
  - sizing
imports:
- name: instance_name
  resource_address: google_sql_database_instance.mysql_instance
  required: false
inputs:
  gcp_provider:
    type: '@facets/gcp_cloud_account'
    optional: false
    displayName: GCP Cloud Account
    description: GCP cloud account and provider configuration
    providers:
    - google
  network:
    type: '@facets/gcp-network-details'
    optional: false
    displayName: VPC Network
    description: VPC network for CloudSQL private IP configuration
outputs:
  default:
    type: '@facets/mysql-cloudsql'
    title: MySQL CloudSQL Instance
  interfaces:
    type: '@facets/mysql-interface'
    title: MySQL Database Interface
iac:
  validated_files:
  - main.tf
  - variables.tf
  - locals.tf
sample:
  kind: mysql
  flavor: gcp-cloudsql
  version: '1.0'
  disabled: true
  spec:
    version_config:
      version: '8.0'
      database_name: app_db
    sizing:
      tier: db-n1-standard-1
      disk_size: 100
