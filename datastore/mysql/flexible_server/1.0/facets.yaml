intent: mysql
flavor: azure-flexible-server
version: '1.0'
clouds:
- azure
description: Azure Database for MySQL - Flexible Server with high availability and
  automated backup. Requires network module with MySQL subnet enabled (database_config.enable_mysql_flexible_subnet
  = true)
spec:
  title: Azure MySQL Flexible Server
  description: Azure Database for MySQL - Flexible Server with high availability and
    automated backup. Network module must have MySQL flexible server subnet enabled.
  type: object
  properties:
    version_config:
      type: object
      title: Version & Basic Configuration
      properties:
        version:
          type: string
          title: MySQL Version
          description: MySQL engine version
          enum:
          - '5.7'
          - 8.0.21
          default: 8.0.21
        database_name:
          type: string
          title: Database Name
          description: Initial database name to create
          default: mydb
          pattern: ^[a-zA-Z][a-zA-Z0-9_]{0,62}$
        charset:
          type: string
          title: Character Set
          description: Character set for the database
          enum:
          - utf8
          - utf8mb4
          - latin1
          default: utf8mb4
        collation:
          type: string
          title: Collation
          description: Collation for the database
          enum:
          - utf8mb4_general_ci
          - utf8mb4_unicode_ci
          - utf8_general_ci
          - latin1_swedish_ci
          default: utf8mb4_unicode_ci
    sizing:
      type: object
      title: Sizing & Performance
      properties:
        sku_name:
          type: string
          title: SKU Name
          description: Azure MySQL Flexible Server SKU. Note - Burstable SKUs do not
            support read replicas or high availability
          enum:
          - B_Standard_B1s
          - B_Standard_B1ms
          - B_Standard_B2s
          - B_Standard_B2ms
          - B_Standard_B4ms
          - GP_Standard_D2ds_v4
          - GP_Standard_D4ds_v4
          - GP_Standard_D8ds_v4
          - GP_Standard_D16ds_v4
          - GP_Standard_D32ds_v4
          - MO_Standard_E2ds_v4
          - MO_Standard_E4ds_v4
          - MO_Standard_E8ds_v4
          - MO_Standard_E16ds_v4
          - MO_Standard_E20ds_v4
          default: B_Standard_B1ms
        storage_gb:
          type: number
          title: Storage Size (GB)
          description: Storage capacity in GB
          minimum: 20
          maximum: 16384
          default: 100
        iops:
          type: number
          title: IOPS
          description: Provisioned IOPS (if supported by SKU)
          minimum: 360
          maximum: 20000
          default: 360
        storage_tier:
          type: string
          title: Storage Tier
          description: Storage performance tier
          enum:
          - P4
          - P6
          - P10
          - P15
          - P20
          - P30
          - P40
          - P50
          - P60
          - P70
          - P80
          default: P10
        read_replica_count:
          type: number
          title: Read Replica Count
          description: Number of read replicas to create. Not supported for Burstable
            SKUs - will be automatically set to 0
          minimum: 0
          maximum: 10
          default: 0
    restore_config:
      type: object
      title: Restore Operations
      x-ui-overrides-only: true
      properties:
        restore_from_backup:
          type: boolean
          title: Restore from Backup
          description: Restore database from existing backup
          default: false
        source_server_id:
          type: string
          title: Source Server ID
          description: Source MySQL server resource ID for restore
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        restore_point_in_time:
          type: string
          title: Restore Point in Time
          description: Point in time to restore from (ISO 8601 format)
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        administrator_login:
          type: string
          title: Administrator Username
          description: Username for connecting to the restored server (server inherits
            actual credentials from source)
          default: mysqladmin
          pattern: ^[a-zA-Z][a-zA-Z0-9_]{0,31}$
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
        administrator_password:
          type: string
          title: Administrator Password
          description: Password for connecting to the restored server (server inherits
            actual credentials from source)
          minLength: 8
          maxLength: 128
          pattern: ^[a-zA-Z0-9!@#$%^&*()_+=\-]{8,128}$
          x-ui-error-message: "Password must be 8-128 chars with valid characters."
          x-ui-visible-if:
            field: spec.restore_config.restore_from_backup
            values:
            - true
    imports:
      type: object
      title: Import Existing Resources
      x-ui-overrides-only: true
      properties:
        import_existing:
          type: boolean
          title: Import Existing Resources
          description: Enable to import existing Azure MySQL Flexible Server resources
          default: false
        server_id:
          type: string
          title: MySQL Server Resource ID
          description: Full Azure resource ID of existing MySQL Flexible Server (format:/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.DBforMySQL/flexibleServers/{name})
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
        database_id:
          type: string
          title: Database Resource ID
          description: Full Azure resource ID of existing database (format:/subscriptions/{sub}/resourceGroups/{rg}/providers/Microsoft.DBforMySQL/flexibleServers/{server}/databases/{name})
          x-ui-visible-if:
            field: spec.imports.import_existing
            values:
              - true
  required:
  - version_config
  - sizing
inputs:
  azure_provider:
    type: '@facets/azure_cloud_account'
    optional: false
    displayName: Azure Cloud Account
    description: Azure provider configuration
    providers:
    - azurerm
  network_details:
    type: '@facets/azure-network-details'
    optional: false
    displayName: Azure Network Details with MySQL Support
    description: Azure VNet with MySQL delegated subnet and DNS zone (requires database_config.enable_mysql_flexible_subnet
      = true)
outputs:
  default:
    type: '@facets/mysql'
    title: MySQL Flexible Server
imports:
- name: server_id
  resource_address: azurerm_mysql_flexible_server.main
  required: true
- name: database_id
  resource_address: azurerm_mysql_flexible_database.databases[0]
  required: false
iac:
  validated_files:
  - main.tf
  - variables.tf
  - locals.tf
  - outputs.tf
sample:
  kind: mysql
  flavor: azure-flexible-server
  version: '1.0'
  disabled: true
  spec:
    version_config:
      version: 8.0.21
      database_name: mydb
      charset: utf8mb4
      collation: utf8mb4_unicode_ci
    sizing:
      sku_name: B_Standard_B1ms
      storage_gb: 100
      iops: 360
      storage_tier: P10
      read_replica_count: 0
